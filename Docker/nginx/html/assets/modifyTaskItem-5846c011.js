import{q as O,d as A,aY as W,a$ as Z,F as J,u as h,x as E,o as R,a as q,b as e,t as $,y as l,f as K,j as i,k as d,B as F,e as z,w as fe,v as _e,z as Q,am as X,a_ as I,p as ee,m as te,_ as oe,b1 as pe}from"./index-3c1f20cf.js";import{h as ae,c as le,a as se,b as ne,E as he}from"./moment-a900c884.js";import{E as ie}from"./el-progress-79455aff.js";import{e as G,F as de,_ as re,E as ve,b as be,h as L,i as xe,m as ke}from"./filezip-710324b4.js";const ge=r=>O({url:"/file",data:r,method:"post",headers:{"Content-Type":"multipart/form-data"}}),we=r=>O({url:"/file",data:r,method:"patch",headers:{"Content-Type":"multipart/form-data"}}),xt=r=>O({url:`/file/taskId/${r}`,method:"get"}),kt=r=>O({url:`/file/${r}`,method:"delete"}),y=r=>(ee("data-v-601e7779"),r=r(),te(),r),ye={flex:"","items-center":"","m-2":"","mt-0":"","h-10":""},Fe={flex:"","items-center":"","flex-grow":"","font-bold":"","h-8":""},$e=y(()=>e("span",{"text-2xl":""},"任务名:",-1)),Ie={flex:"","items-center":"","mt-1":"","px-1":"","ml-2":"","h-8":"","border-2":"","bg-black":"",rounded:"","text-white":""},Te={"font-bold":""},De={"font-bold":""},Be=y(()=>e("hr",{"border-b-2":"","m-2":"","mb-4":""},null,-1)),Ce={flex:"","flex-col":"","mx-2":""},Ve={flex:"","items-center":"","text-2":"","px-2":"","h-10":"","border-2":"",rounded:"","mb-4":""},Ee=y(()=>e("span",{"w-15":""},"创建者:",-1)),Re={"font-bold":"","flex-grow":""},qe={flex:"","text-2":"","border-2":"",rounded:"","mb-4":""},Pe=y(()=>e("span",{"w-15":"","mt-2.5":"","ml-2":""},"任务简介:",-1)),Se=["value"],Ye={flex:"","w-full":""},je={key:0,flex:"","items-center":"","pl-2":"","text-2":"","h-10":"","border-2":"",rounded:"","mb-4":"","mr-4":"","min-w-40":"",class:"w-1/3"},Ne=y(()=>e("span",{"w-15":""},"前置材料:",-1)),Oe={"font-bold":""},Me={flex:"","items-center":"","px-2":"","text-2":"","h-10":"","border-2":"",rounded:"","mb-4":"","flex-grow":""},Ue=y(()=>e("span",{"w-15":""},"创建时间:",-1)),He={"font-bold":""},ze={"border-2":"",rounded:"","mx-2":""},Ge={flex:"","m-2":"","mb-4":"","items-center":"","font-bold":""},Le={"flex-grow":"",flex:"","items-center":""},Ae=y(()=>e("span",{"mr-1":""}," 任务提交",-1)),We={flex:"","justify-between":"","text-blue":""},Ze={flex:"","flex-grow":"","items-center":"","justify-center":"","rounded-xl":""},Je=y(()=>e("p",null,"拖拽文件到此处或点击上传",-1)),Ke={flex:"","items-center":"","m-2":"","h-10":""},Qe=A({__name:"uploadFileTaskItem",setup(r){const _=W(),c=Z(),v=()=>{let u=null;x==="task"?u=G(_.id):u=G(c.click.id),u.then(a=>{var t;s.value=a.data,(t=a.data)!=null&&t.File&&(n.id=a.data.File.id),n.taskId=a.data.task.id}).catch(()=>{I({message:"任务不存在",type:"error"}),C.push("/main/group"),c.update={time:new Date().valueOf(),type:"task"}})},C=J(),x=C.currentRoute.value.name,m=h();x==="task"?m.value=_.id:x==="groupTask"&&(m.value=c.click.id);const s=h({task:{id:"",name:"",introduce:"",memberId:"",groupId:"",activeStatue:!0,dataPath:null,createTime:new Date,member:{id:"",name:"",groupId:"",userId:"",role:"admin",joinTime:new Date,icon:""}},File:null}),b=()=>{window.location.href="/data/task/"+s.value.task.dataPath},P=()=>{s.value.File&&(window.location.href="/data/file/"+s.value.File.filePath)};_.$subscribe(async(u,a)=>{a.type==="upload"&&m.value!==a.id&&(m.value=_.id,v())},{detached:!0,deep:!0}),c.$subscribe(async(u,a)=>{a.click.type==="task"&&a.click.status==="add"&&m.value!==a.click.id&&(m.value=c.click.id,v())},{detached:!0,deep:!0});const k=h(),T=h([]),M=(u,a)=>{var t;T.value=a,w.hasFile=!0,(t=D.value)==null||t.validateField("hasFile")},S=(u,a)=>{var t;T.value=a,a.length===0&&(w.hasFile=!1),(t=D.value)==null||t.validateField("hasFile")},Y=()=>{k.value.clearFiles(),w.hasFile=!1,n.file=new Blob},n=E({id:"",taskId:"",file:new Blob}),w=E({hasFile:!1}),D=h(),U=E({hasFile:[{required:!0,trigger:"blur",validator:(u,a,t)=>a?t():t(new Error("未上传文件"))},{required:!0,trigger:"change",validator:(u,a,t)=>a?t():t(new Error("未上传文件"))}]}),j=u=>{u&&u.validate(async a=>{var t;if(a){const o=[];T.value.forEach(f=>{f.raw&&o.push(f.raw)}),n.file=await de(o);let p=null;(t=s.value)!=null&&t.File?p=we(n):p=ge({taskId:n.taskId,file:n.file}),p.then(()=>{v(),I({message:"成功提交文件",type:"success"}),x==="groupTask"&&(c.update={time:new Date().valueOf(),type:"task"}),_.time=new Date().valueOf(),Y()}).catch(()=>{I({message:"提交文件失败",type:"error"})})}})};return v(),(u,a)=>{const t=le,o=re,p=ie,f=se,N=ne;return R(),q(X,null,[e("div",ye,[e("div",Fe,[$e,e("div",Ie,[e("span",Te,$(l(s).task.name),1)])]),e("div",{flex:"","items-center":"","text-2":"","px-2":"","h-8":"","border-2":"",class:K(l(s).File?"bg-green":"bg-black"),rounded:"","text-white":""},[e("span",De,$(l(s).File?"完成":"未完成"),1)],2)]),Be,e("div",Ce,[e("div",Ve,[Ee,e("span",Re,$(l(s).task.member.name),1)]),e("div",qe,[Pe,e("textarea",{"w-full":"","ml-2":"","mt-2.5":"","min-h-6.5":"","h-40":"","font-bold":"","focus:outline-none":"",disabled:"","bg-white":"",value:l(s).task.introduce},null,8,Se)]),e("div",Ye,[l(s).task.dataPath!==null?(R(),q("div",je,[Ne,e("span",Oe,[i(t,{type:"primary",text:"",onClick:a[0]||(a[0]=V=>b())},{default:d(()=>[F("点击下载")]),_:1})])])):z("",!0),e("div",Me,[Ue,e("span",He,$(l(ae)(l(s).task.createTime).format("YYYY-MM-DD HH:mm:ss")),1)])])]),e("div",ze,[e("div",Ge,[e("div",Le,[Ae,fe(e("span",{"text-1":"","text-blue":"","cursor-pointer":"",onClick:a[1]||(a[1]=V=>Y())},"[一键取消文件]",512),[[_e,l(w).hasFile]])]),l(s).File?(R(),q("span",{key:0,onClick:a[2]||(a[2]=V=>P()),"text-1":"","text-blue":"","cursor-pointer":""}," 查看提交文件 ")):z("",!0)]),i(N,{rules:l(U),model:l(w),ref_key:"ruleFormRef",ref:D,onSubmit:a[4]||(a[4]=Q(()=>{},["prevent"]))},{default:d(()=>[i(f,{prop:"hasFile","mx-2":""},{default:d(()=>[i(p,{flex:"","flex-col":"","mt-2":"","flex-grow":"",action:"#",ref_key:"upload",ref:k,"file-list":l(T),"on-change":M,"on-remove":S,"auto-upload":!1,multiple:"",drag:""},{default:d(()=>[e("div",We,[e("div",Ze,[i(o,{"text-8.4":""}),Je])])]),_:1},8,["file-list"])]),_:1}),e("div",Ke,[i(t,{type:"primary","w-full":"",onClick:a[3]||(a[3]=V=>j(l(D)))},{default:d(()=>[F("提交 / 修改")]),_:1})])]),_:1},8,["rules","model"])])],64)}}});const gt=oe(Qe,[["__scopeId","data-v-601e7779"]]),B=r=>(ee("data-v-8121d013"),r=r(),te(),r),Xe={flex:"","items-center":"","m-2":"","mt-0":"","h-10":""},et=B(()=>e("div",{flex:"","items-center":"","flex-grow":"","font-bold":"","text-2xl":"","h-8":""},"群任务",-1)),tt={flex:"","items-center":"","text-xs":"","px-1":"","ml-2":"","h-8":"","border-2":"","bg-black":"",rounded:"","text-white":""},ot=B(()=>e("span",null,"创建者:",-1)),at={"font-bold":""},lt={flex:"","items-center":"","text-xs":"","px-1":"","ml-2":"","h-8":"","border-2":"","bg-black":"",rounded:"","text-white":""},st=B(()=>e("span",null,"时间:",-1)),nt={"font-bold":""},it=B(()=>e("hr",{"border-b-2":"","m-2":"","mb-4":""},null,-1)),dt={flex:"","items-center":"","justify-center":"","text-xs":"","mb-4":"","h-8":"","border-2":"","bg-gray":"",rounded:"","text-white":""},rt=B(()=>e("span",{"mr-1":""},"标识:",-1)),ut={"font-bold":""},ct={key:0},mt={flex:"","flex-grow":"","items-center":"","justify-center":"","rounded-xl":""},ft=B(()=>e("p",null,"拖拽文件到此处或点击上传",-1)),_t=A({__name:"modifyTaskItem",setup(r){const _=W(),c=Z(),v=()=>{let t=null;x==="task"?t=L(_.id).then(o=>s.value=o.data):t=L(c.click.id).then(o=>s.value=o.data),t.then(()=>{n.id=s.value.id,n.name=s.value.name,n.introduce=s.value.introduce,n.file=new Blob}).catch(async()=>{C.push("/main/group"),c.update={time:new Date().valueOf(),type:"all"},I({message:"权限不足/任务不存在",type:"error"})})},C=J(),x=C.currentRoute.value.name,m=h();x==="task"?m.value=_.id:x==="groupTask"&&(m.value=c.click.id);const s=h({id:"",name:"",introduce:"",memberId:"",groupId:"",activeStatue:!0,dataPath:null,createTime:new Date,member:{id:"",name:"",groupId:"",userId:"",role:"admin",joinTime:new Date,icon:""}});_.$subscribe(async(t,o)=>{o.type==="modify"&&m.value!==o.id&&(m.value=_.id,v())},{detached:!0,deep:!0}),c.$subscribe(async(t,o)=>{o.click.type==="task"&&o.click.status==="modify"&&m.value!==o.click.id&&(m.value=c.click.id,v())},{detached:!0,deep:!0});const b=h(!1),P=h(),k=h([]),T=(t,o)=>{k.value=o},M=(t,o)=>{k.value=o},S=()=>{P.value.clearFiles()},Y=()=>{window.location.href="/data/task/"+s.value.dataPath},n=E({id:"",name:"",introduce:"",file:new Blob});v();const w=h(),D=E({name:[{required:!0,message:"组名不能为空",trigger:"blur"},{required:!0,message:"组名不能为空",trigger:"change"}],introduce:[{required:!0,message:"简介不能为空",trigger:"blur"},{required:!0,message:"简介不能为空",trigger:"change"}]}),U=t=>{t&&(S(),b.value=!1,n.file=new Blob)},j=t=>{ke(n,b.value&&k.value.length!==0).then(()=>{v(),I({message:`成功修改任务${n.name}`,type:"success"})}).catch(()=>I({message:`修改任务${n.name}失败`,type:"error"})).finally(()=>{x==="groupTask"&&(c.update={time:new Date().valueOf(),type:"task"}),_.time=new Date().valueOf(),U(t)})},u=t=>{t&&t.validate(async o=>{if(o)if(b.value&&k.value.length!==0){const p=[];k.value.forEach(f=>{f.raw&&p.push(f.raw)}),n.file=await de(p),j(t)}else j(t)})},a=async()=>{await xe(s.value.id),v(),I({message:`成功移除${n.name}的文件`,type:"success"})};return(t,o)=>{const p=he,f=se,N=ve,V=be,H=le,ue=re,ce=ie,me=ne;return R(),q(X,null,[e("div",Xe,[et,e("div",tt,[ot,e("span",at,$(l(s).member.name),1)]),e("div",lt,[st,e("span",nt,$(l(ae)(l(s).createTime).format("YYYY-MM-DD HH:mm:ss")),1)])]),it,i(me,{"mx-2":"","hide-required-asterisk":"","status-icon":"",rules:l(D),model:l(n),ref_key:"ruleFormRef",ref:w,onSubmit:o[7]||(o[7]=Q(()=>{},["prevent"]))},{default:d(()=>[e("div",dt,[rt,e("span",ut,"["+$(l(s).id)+"]",1)]),i(f,{label:"任务名称",prop:"name"},{default:d(()=>[i(p,{modelValue:l(n).name,"onUpdate:modelValue":o[0]||(o[0]=g=>l(n).name=g)},null,8,["modelValue"])]),_:1}),i(f,{label:"任务简介",prop:"introduce"},{default:d(()=>[i(p,{"h-50":"",resize:"none",type:"textarea",modelValue:l(n).introduce,"onUpdate:modelValue":o[1]||(o[1]=g=>l(n).introduce=g)},null,8,["modelValue"])]),_:1}),i(f,{label:"开启上传"},{default:d(()=>[i(V,{modelValue:l(b),"onUpdate:modelValue":o[3]||(o[3]=g=>pe(b)?b.value=g:null)},{default:d(()=>[i(N,{label:!0},{default:d(()=>[F("开启")]),_:1}),i(N,{label:!1,onClick:o[2]||(o[2]=g=>S())},{default:d(()=>[F("关闭")]),_:1})]),_:1},8,["modelValue"]),l(s).dataPath?(R(),q("div",ct,[i(H,{onClick:o[4]||(o[4]=g=>Y()),type:"primary",plain:""},{default:d(()=>[F("下载")]),_:1}),i(H,{onClick:o[5]||(o[5]=g=>a()),type:"danger",plain:""},{default:d(()=>[F("删除")]),_:1})])):z("",!0)]),_:1}),i(f,{label:"文件上传"},{default:d(()=>[i(ce,{flex:"","flex-col":"","flex-grow":"",action:"#",ref_key:"upload",ref:P,"file-list":l(k),"on-change":T,"on-remove":M,"auto-upload":!1,disabled:!l(b),multiple:"",drag:""},{default:d(()=>[e("div",{flex:"","justify-between":"",class:K(l(b)?"text-blue":"")},[e("div",mt,[i(ue,{"text-8.4":""}),ft])],2)]),_:1},8,["file-list","disabled"])]),_:1}),i(f,null,{default:d(()=>[i(H,{type:"primary","w-full":"",onClick:o[6]||(o[6]=g=>u(l(w)))},{default:d(()=>[F("修改")]),_:1})]),_:1})]),_:1},8,["rules","model"])],64)}}});const wt=oe(_t,[["__scopeId","data-v-8121d013"]]);export{wt as _,gt as a,xt as f,kt as g};
